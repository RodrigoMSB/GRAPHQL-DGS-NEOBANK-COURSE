# ğŸ“˜ CHAPTER 01: Fundamentos de GraphQL y Contexto Corporativo

**DuraciÃ³n:** 2 horas (5 secciones Ã— 30 min)  
**Nivel:** Desarrolladores backend con experiencia  
**Stack:** Spring Boot 3.4.5 + GraphQL Java 24.x + Java 17

---

## ğŸ¯ OBJETIVO DEL CAPÃTULO

Introducir GraphQL desde fundamentos hasta implementaciÃ³n prÃ¡ctica, usando un caso real de **Investment Portfolio Tracker** (NeoBank). Los alumnos comprenderÃ¡n **POR QUÃ‰ GraphQL existe**, **QUÃ‰ problemas resuelve** y **CÃ“MO implementarlo** con Spring Boot.

---

## ğŸ“‹ CONTENIDO DEL CAPÃTULO

### SecciÃ³n 1.1 â€” De REST a GraphQL (30 min)
**Conceptos clave:**
- âŒ Overfetching: REST devuelve mÃ¡s datos de los necesarios
- âŒ Underfetching: REST requiere mÃºltiples llamadas HTTP
- âœ… Endpoint Ãºnico: `/graphql` vs mÃºltiples endpoints REST
- âœ… Declarativo: El cliente pide exactamente lo que necesita

**Ejemplo prÃ¡ctico:** ComparaciÃ³n lado a lado REST vs GraphQL para obtener portfolios de inversiÃ³n.

---

### SecciÃ³n 1.2 â€” Componentes y lenguaje base (30 min)
**Los 5 pilares de GraphQL:**
1. **Schema:** Contrato explÃ­cito entre cliente y servidor
2. **Types:** Portfolio, Asset, Performance (tipos del dominio)
3. **Queries:** Operaciones de lectura (`myPortfolios`, `portfolio(id)`)
4. **Mutations:** Operaciones de escritura (`createPortfolio`, `addAsset`)
5. **Resolvers:** LÃ³gica de conexiÃ³n entre queries y fuentes de datos

**Ejemplo prÃ¡ctico:** Schema completo de Investment Portfolio con tipos anidados.

---

### SecciÃ³n 1.3 â€” Consultas anidadas y uso de variables (30 min)
**Conceptos clave:**
- AnidaciÃ³n: `portfolio â†’ assets â†’ performance` (3 niveles)
- Variables tipadas: `query($id: ID!)` para reusabilidad
- ValidaciÃ³n automÃ¡tica: GraphQL valida tipos antes de ejecutar
- Consultas parametrizadas seguras (anti SQL-injection)

**Ejemplo prÃ¡ctico:** Obtener portfolio completo con assets y performance en una sola query.

---

### SecciÃ³n 1.4 â€” Filtros, orden y paginaciÃ³n (30 min)
**Conceptos clave:**
- Filtrado: `filter: {assetType: STOCK, minValue: 5000}`
- Ordenamiento: `sort: {field: TOTAL_VALUE, direction: DESC}`
- PaginaciÃ³n cursor-based: `pagination: {limit: 10, after: "cursor"}`
- LÃ­mites del backend: ProtecciÃ³n contra queries costosas

**Ejemplo prÃ¡ctico:** Query compleja combinando filtro + orden + paginaciÃ³n.

---

### SecciÃ³n 1.5 â€” Tipado, nullabilidad y seguridad bÃ¡sica (30 min)
**Conceptos clave:**
- Tipado fuerte: `Float!`, `String!`, `[Asset!]!`
- Non-nullable (`!`): Campos obligatorios validados automÃ¡ticamente
- Enums: `AssetType: STOCK | CRYPTO | ETF | BOND | COMMODITY`
- Seguridad bÃ¡sica: JWT, API Keys, field-level authorization

**Ejemplo prÃ¡ctico:** ValidaciÃ³n automÃ¡tica de tipos + autenticaciÃ³n JWT.

---

## ğŸš€ QUICK START

### Prerrequisitos
```bash
- Java 17+ (LTS)
- Maven 3.8+
- Git
- curl (para testing)
- Editor de cÃ³digo (IntelliJ IDEA, VS Code, etc.)
```

### 1. Clonar y posicionarse en el capÃ­tulo
```bash
git clone <repo-url>
cd GRAPHQL-DGS-NEOBANK-COURSE/CHAPTER_01/investment-portfolio-graphql
```

### 2. Compilar el proyecto
```bash
mvn clean install
```

### 3. Ejecutar la aplicaciÃ³n
```bash
mvn spring-boot:run
```

**Salida esperada:**
```
  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::               (v3.4.5)

Started InvestmentPortfolioGraphqlApplication in 2.145 seconds
```

### 4. Verificar que funciona
```bash
curl http://localhost:8080
# Debe responder con el servidor activo
```

---

## ğŸ§ª TESTING CON SCRIPT AUTOMATIZADO

### Ejecutar todos los tests (MODO CLASE)
```bash
# Modo interactivo (pausa entre tests para explicar)
./test-chapter01.sh
```

**Uso en clase:**
1. Ejecutas el script
2. Aparece el test #1 con su resultado
3. Presionas Enter
4. Explicas el concepto
5. Presionas Enter para el siguiente test
6. Repites hasta completar las 5 secciones

### Ejecutar todos los tests (MODO RÃPIDO)
```bash
# Modo silencioso (sin pausas, para CI/CD)
./test-chapter01.sh -s
```

**Resultado esperado:**
```
================================================================================
ğŸ“Š RESUMEN DE RESULTADOS
================================================================================
Total de tests ejecutados: 34
âœ… Tests exitosos: 34
âŒ Tests fallidos: 0

ğŸ‰ Â¡TODOS LOS TESTS PASARON! Chapter 01 completo y funcional.

Cobertura del temario:
  âœ… SecciÃ³n 1.1 - REST vs GraphQL (7 tests)
  âœ… SecciÃ³n 1.2 - Componentes base (9 tests)
  âœ… SecciÃ³n 1.3 - AnidaciÃ³n y variables (5 tests)
  âœ… SecciÃ³n 1.4 - Filtros y paginaciÃ³n (7 tests)
  âœ… SecciÃ³n 1.5 - Tipado y seguridad (6 tests)

TOTAL: 34 tests automatizados
```

---

## ğŸ“ CÃ“MO USAR ESTE PROYECTO EN CLASE

### MetodologÃ­a: "Show, Don't Build"

Este proyecto estÃ¡ diseÃ±ado para **DEMOSTRAR** GraphQL funcionando, no para construir desde cero durante la clase.

**Flujo recomendado por secciÃ³n:**

#### 1. ContextualizaciÃ³n (5 min)
- Explica el problema que resuelve la secciÃ³n
- Muestra el cÃ³digo relevante en el editor

#### 2. DemostraciÃ³n en vivo (15 min)
- Ejecuta `./test-chapter01.sh` en modo interactivo
- Para en cada test para explicar:
  - QuÃ© hace la query/mutation
  - QuÃ© resultado esperas
  - Por quÃ© es importante

#### 3. ExploraciÃ³n GraphiQL (5 min)
- Abre http://localhost:8080/graphiql
- Deja que los alumnos prueben queries
- Muestra introspection y auto-documentaciÃ³n

#### 4. CÃ³digo deep-dive (5 min)
- Muestra el resolver correspondiente
- Explica cÃ³mo conecta con el servicio
- Responde preguntas

**Total:** 30 min por secciÃ³n Ã— 5 secciones = 2.5 horas (flexibilidad para preguntas)

---

## ğŸ” ENDPOINTS DISPONIBLES

### GraphQL Endpoint
```
POST http://localhost:8080/graphql
Content-Type: application/json

{
  "query": "{ myPortfolios { name } }"
}
```

### GraphiQL Interface (Playground)
```
http://localhost:8080/graphiql
```

### REST Endpoints (para comparaciÃ³n)
```
GET  http://localhost:8080/api/rest/portfolios
GET  http://localhost:8080/api/rest/portfolios/{id}
GET  http://localhost:8080/api/rest/portfolios/{id}/assets
GET  http://localhost:8080/api/rest/portfolios/{id}/performance
```

---

## ğŸ“Š QUERIES DE EJEMPLO

### Query bÃ¡sica
```graphql
{
  myPortfolios {
    id
    name
    totalValue
  }
}
```

### Query con argumentos
```graphql
{
  portfolio(id: "portfolio-001") {
    name
    totalValue
    assets {
      symbol
      currentPrice
      profitLossPercent
    }
  }
}
```

### Query anidada compleja
```graphql
{
  portfolio(id: "portfolio-001") {
    name
    assets {
      symbol
      name
      assetType
    }
    performance {
      totalReturn
      yearReturn
      bestPerformer {
        symbol
        profitLossPercent
      }
    }
  }
}
```

### Query con variables
```graphql
query GetPortfolio($id: ID!) {
  portfolio(id: $id) {
    name
    totalValue
  }
}

# Variables:
{
  "id": "portfolio-001"
}
```

### Query con filtros y paginaciÃ³n
```graphql
{
  assets(
    portfolioId: "portfolio-001"
    filter: {
      assetType: STOCK
      minValue: 5000
    }
    sort: {
      field: PROFIT_LOSS_PERCENT
      direction: DESC
    }
    pagination: {
      limit: 5
    }
  ) {
    totalCount
    edges {
      node {
        symbol
        totalValue
        profitLossPercent
      }
    }
    pageInfo {
      hasNextPage
      endCursor
    }
  }
}
```

### Mutation - Crear portfolio
```graphql
mutation {
  createPortfolio(input: {
    name: "Tech Growth Portfolio"
  }) {
    success
    message
    portfolio {
      id
      name
      totalValue
    }
  }
}
```

### Mutation - Agregar asset
```graphql
mutation {
  addAsset(input: {
    portfolioId: "portfolio-001"
    symbol: "NVDA"
    assetType: STOCK
    quantity: 10
    buyPrice: 500
  }) {
    success
    message
  }
}
```

---

## ğŸ“ ESTRUCTURA DEL PROYECTO

```
investment-portfolio-graphql/
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/com/neobank/graphql/
â”‚   â”‚   â”‚   â”œâ”€â”€ InvestmentPortfolioGraphqlApplication.java
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ config/                    # ConfiguraciÃ³n
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ GraphQLConfig.java     # ConfiguraciÃ³n GraphQL
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SecurityConfig.java    # Seguridad JWT
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ controller/                # Controllers
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ graphql/               # GraphQL resolvers
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PortfolioQueryResolver.java
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PortfolioMutationResolver.java
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AssetQueryResolver.java
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ AssetMutationResolver.java
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ rest/                  # REST endpoints (comparaciÃ³n)
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ PortfolioRestController.java
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ model/                     # Domain models
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Portfolio.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Asset.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Performance.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AssetType.java         # Enum
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ input/                 # Input types
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ CreatePortfolioInput.java
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ AddAssetInput.java
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ AssetFilterInput.java
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ PaginationInput.java
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ service/                   # Business logic
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PortfolioService.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AssetService.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ MockDataService.java   # Datos de prueba
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ response/                  # Response wrappers
â”‚   â”‚   â”‚       â”œâ”€â”€ PortfolioResponse.java
â”‚   â”‚   â”‚       â”œâ”€â”€ AssetResponse.java
â”‚   â”‚   â”‚       â””â”€â”€ AssetConnection.java   # PaginaciÃ³n
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â”œâ”€â”€ application.properties     # ConfiguraciÃ³n Spring
â”‚   â”‚       â””â”€â”€ graphql/                   # GraphQL schemas
â”‚   â”‚           â””â”€â”€ schema.graphqls        # Schema principal
â”‚   â”‚
â”‚   â””â”€â”€ test/
â”‚       â””â”€â”€ java/com/neobank/graphql/
â”‚           â””â”€â”€ InvestmentPortfolioGraphqlApplicationTests.java
â”‚
â”œâ”€â”€ pom.xml                                # Maven dependencies
â”œâ”€â”€ test-chapter01.sh                      # Script de testing
â””â”€â”€ README.md                              # Este archivo
```

---

## ğŸ”§ TECNOLOGÃAS UTILIZADAS

### Core Stack
- **Java 17** (LTS hasta 2029)
- **Spring Boot 3.4.5** (Ãºltima estable)
- **Spring for GraphQL 1.4.x** (integraciÃ³n oficial)
- **GraphQL Java 24.x** (motor GraphQL)

### Dependencias principales
```xml
<!-- GraphQL -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-graphql</artifactId>
</dependency>

<!-- Web (REST comparison) -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
</dependency>

<!-- Security (JWT) -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-security</artifactId>
</dependency>

<!-- JWT -->
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt-api</artifactId>
    <version>0.12.6</version>
</dependency>

<!-- Lombok -->
<dependency>
    <groupId>org.projectlombok</groupId>
    <artifactId>lombok</artifactId>
</dependency>
```

---

## ğŸ“š CONCEPTOS ENSEÃ‘ADOS

### âœ… Nivel BÃ¡sico (Secciones 1.1 - 1.2)
- Diferencias REST vs GraphQL
- Overfetching y underfetching
- Schema como contrato
- Types, Queries, Mutations
- Resolvers bÃ¡sicos

### âœ… Nivel Intermedio (Secciones 1.3 - 1.4)
- Consultas anidadas
- Variables tipadas
- Filtrado y ordenamiento
- PaginaciÃ³n cursor-based
- ValidaciÃ³n automÃ¡tica

### âœ… Nivel Avanzado (SecciÃ³n 1.5)
- Tipado fuerte y nullabilidad
- Enums y validaciÃ³n
- Introspection
- Seguridad bÃ¡sica (JWT)
- Field-level authorization

---

## ğŸ¯ COBERTURA DE TESTS

### SecciÃ³n 1.1 - REST vs GraphQL (7 tests)
- âœ… Overfetching: REST devuelve todo
- âœ… GraphQL selectivo: Solo campos pedidos
- âœ… Underfetching: REST mÃºltiples llamadas
- âœ… GraphQL eficiente: Una sola llamada
- âœ… Endpoint Ãºnico vs mÃºltiples endpoints

### SecciÃ³n 1.2 - Componentes base (9 tests)
- âœ… Schema types validados
- âœ… Queries simples y con argumentos
- âœ… Mutations (create, add, remove)
- âœ… Enums validados
- âœ… Resolvers funcionando

### SecciÃ³n 1.3 - AnidaciÃ³n y variables (5 tests)
- âœ… AnidaciÃ³n nivel 1 (portfolio â†’ assets)
- âœ… AnidaciÃ³n nivel 2 (portfolio â†’ performance â†’ bestPerformer)
- âœ… Variables tipadas ($id: ID!)
- âœ… ValidaciÃ³n de variables
- âœ… MÃºltiples relaciones en una query

### SecciÃ³n 1.4 - Filtros y paginaciÃ³n (7 tests)
- âœ… Filtrado por tipo (AssetType)
- âœ… Filtrado por rango (minValue)
- âœ… Ordenamiento DESC
- âœ… Ordenamiento por profit
- âœ… PaginaciÃ³n cursor-based
- âœ… Query compleja (filtro + orden + paginaciÃ³n)
- âœ… LÃ­mites controlados por backend

### SecciÃ³n 1.5 - Tipado y seguridad (6 tests)
- âœ… ValidaciÃ³n de tipos (Float!, String!)
- âœ… Non-nullable fields
- âœ… Enum validation
- âœ… Introspection habilitada
- âœ… ValidaciÃ³n de argumentos obligatorios
- âœ… Estructura de respuesta consistente

**TOTAL: 34 tests automatizados** ğŸ‰

---

## ğŸ› TROUBLESHOOTING

### Problema: Puerto 8080 ya en uso
```bash
# Encuentra y mata el proceso
lsof -i :8080
kill -9 <PID>

# O cambia el puerto en application.properties
server.port=8081
```

### Problema: Tests fallan en Windows
```bash
# AsegÃºrate de usar GitBash, no CMD
# En GitBash:
bash test-chapter01.sh -s
```

### Problema: "mvn: command not found"
```bash
# Instala Maven
# Mac:
brew install maven

# Linux:
sudo apt-get install maven

# Windows:
# Descarga desde https://maven.apache.org/download.cgi
```

### Problema: Java version incorrecta
```bash
# Verifica versiÃ³n
java -version

# Debe mostrar Java 17 o superior
# Si no, instala Java 17:
# Mac:
brew install openjdk@17

# Linux:
sudo apt-get install openjdk-17-jdk
```

### Problema: Script .sh no ejecutable
```bash
# Dar permisos de ejecuciÃ³n
chmod +x test-chapter01.sh
```

---

## ğŸ“ NOTAS PEDAGÃ“GICAS

### Para el instructor:

1. **Tiempo es ajustado:** 30 min por secciÃ³n es el mÃ­nimo. Deja buffer para preguntas.

2. **No construyas desde cero:** El cÃ³digo ya estÃ¡ completo. EnfÃ³cate en EXPLICAR, no en escribir.

3. **Usa GraphiQL:** Es tu mejor herramienta pedagÃ³gica. Auto-documentaciÃ³n + validaciÃ³n en vivo.

4. **Compara siempre con REST:** Los alumnos conocen REST. Usa eso como puente.

5. **Tests son tu guÃ­a:** Cada test representa un concepto. Ãšsalos como checklist.

6. **Prioriza conceptos sobre cÃ³digo:** Que entiendan el "por quÃ©" antes del "cÃ³mo".

### Para el alumno:

1. **No te preocupes por memorizar:** EnfÃ³cate en entender los conceptos.

2. **Experimenta en GraphiQL:** Es tu sandbox. Prueba queries locas.

3. **Lee los tests:** Muestran casos de uso reales y validaciones.

4. **Pregunta mucho:** Este es un capÃ­tulo denso. No hay preguntas tontas.

---

## ğŸš€ PRÃ“XIMOS PASOS

DespuÃ©s de completar este capÃ­tulo, los alumnos estarÃ¡n listos para:

- **CHAPTER_02:** Cashback Rewards Schema (diseÃ±o avanzado de schemas)
- **CHAPTER_03:** DGS Framework completo con DataLoader
- **CHAPTER_04:** Persistencia con JPA y transacciones
- **CHAPTER_05:** Apollo Federation (arquitectura distribuida)

---

## ğŸ“– RECURSOS ADICIONALES

### DocumentaciÃ³n oficial
- [GraphQL Specification](https://spec.graphql.org/)
- [GraphQL Java](https://www.graphql-java.com/)
- [Spring for GraphQL](https://docs.spring.io/spring-graphql/reference/)

### Herramientas recomendadas
- [GraphiQL](http://localhost:8080/graphiql) - Playground incluido
- [Postman](https://www.postman.com/) - Testing de APIs
- [Insomnia](https://insomnia.rest/) - Cliente GraphQL

### Lecturas complementarias
- [GraphQL Best Practices](https://graphql.org/learn/best-practices/)
- [Schema Design Guide](https://www.apollographql.com/docs/apollo-server/schema/schema/)

---

## ğŸ‘¥ CONTRIBUCIONES

Este proyecto es parte del curso **"El Mejor Curso de GraphQL del Mundo"**.

**Instructor:** [Tu nombre]  
**VersiÃ³n:** 1.0.0  
**Ãšltima actualizaciÃ³n:** Noviembre 2025

---

## ğŸ“„ LICENCIA

Este material es de uso educativo exclusivo para el curso de GraphQL.

---

## âœ¨ CHANGELOG

### v1.0.0 (2025-11-15)
- âœ… Stack actualizado a Spring Boot 3.4.5 + GraphQL Java 24.x
- âœ… 34 tests automatizados funcionando
- âœ… Script portable Mac/Linux/Windows
- âœ… Cobertura completa del temario (5 secciones)
- âœ… README completo con instrucciones detalladas

---

**Â¡Disfruta el mejor curso de GraphQL del mundo!** ğŸš€ğŸ”¥