{
  "info": {
    "_postman_id": "ch03-dgs-implementation",
    "name": "CHAPTER 03: DGS Implementation - Cashback Rewards",
    "description": "Complete test suite for Chapter 03 - GraphQL Implementation with Netflix DGS\n\n**Covers:**\n- Section 3.1: Framework DGS & Project Structure (6 tests)\n- Section 3.2: Schema Definition & Codegen (6 tests)\n- Section 3.3: Resolvers with @DgsData (6 tests)\n- Section 3.4: Mutations & Business Logic (6 tests)\n- Section 3.5: DataLoader & N+1 Problem (6 tests)\n\n**Total: 30 automated tests**\n\n**Feature:** Cashback Rewards System\n**Stack:** Spring Boot 3.4.5 + Netflix DGS 8.1.1 + GraphQL Java\n\nMake sure the server is running: `mvn spring-boot:run`",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Section 3.1 - Framework DGS & Project Structure",
      "item": [
        {
          "name": "3.1.1 - GraphQL Endpoint Available",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response has __typename Query\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.__typename).to.eql('Query');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "{\n  __typename\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**DGS Framework Test**\n\nValidates that the GraphQL endpoint is responding correctly.\n\nDGS automatically exposes `/graphql` endpoint when properly configured."
          },
          "response": []
        },
        {
          "name": "3.1.2 - Introspection Enabled",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Schema has types\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.__schema.types).to.be.an('array');",
                  "    pm.expect(jsonData.data.__schema.types.length).to.be.above(10);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "{\n  __schema {\n    types {\n      name\n    }\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**Introspection Query**\n\nValidates that GraphQL introspection is enabled.\n\nThis allows tools like GraphiQL, Apollo Studio to explore the schema."
          },
          "response": []
        },
        {
          "name": "3.1.3 - Schema Auto-Loaded",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"User type is defined\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.__type.name).to.eql('User');",
                  "});",
                  "",
                  "pm.test(\"User has required fields\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    var fieldNames = jsonData.data.__type.fields.map(f => f.name);",
                  "    pm.expect(fieldNames).to.include.members(['id', 'email', 'fullName', 'tier']);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "{\n  __type(name: \"User\") {\n    name\n    fields {\n      name\n    }\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**Schema Auto-Loading**\n\nDGS automatically loads schema from `src/main/resources/schema/*.graphqls`"
          },
          "response": []
        },
        {
          "name": "3.1.4 - Enum Types Registered",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"RewardTier enum exists\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.__type.name).to.eql('RewardTier');",
                  "});",
                  "",
                  "pm.test(\"RewardTier has all values\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    var values = jsonData.data.__type.enumValues.map(v => v.name);",
                  "    pm.expect(values).to.include.members(['BRONZE', 'SILVER', 'GOLD', 'PLATINUM']);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "{\n  __type(name: \"RewardTier\") {\n    name\n    enumValues {\n      name\n    }\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**Enum Registration**\n\nDGS automatically maps GraphQL enums to Java enums."
          },
          "response": []
        },
        {
          "name": "3.1.5 - Custom Scalars Registered",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"DateTime scalar exists\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.__type.name).to.eql('DateTime');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "{\n  __type(name: \"DateTime\") {\n    name\n    kind\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**Custom Scalar**\n\nDateTime scalar for LocalDateTime in Java.\n\nRegistered in `ScalarConfiguration.java`"
          },
          "response": []
        },
        {
          "name": "3.1.6 - DGS Processes Queries",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Query executed successfully\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.user).to.exist;",
                  "    pm.expect(jsonData.data.user.id).to.eql('user-001');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "{\n  user(id: \"user-001\") {\n    id\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**DGS Query Processing**\n\nValidates that DGS processes queries end-to-end."
          },
          "response": []
        }
      ]
    },
    {
      "name": "Section 3.2 - Schema Definition & Codegen",
      "item": [
        {
          "name": "3.2.1 - User Type Defined in Schema",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"User type has all fields\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    var fieldNames = jsonData.data.__type.fields.map(f => f.name);",
                  "    pm.expect(fieldNames).to.include.members(['id', 'email', 'fullName', 'tier', 'totalCashbackEarned', 'availableCashback']);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "{\n  __type(name: \"User\") {\n    name\n    fields {\n      name\n      type {\n        name\n      }\n    }\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**Schema Definition**\n\nUser type defined in `cashback-service.graphqls` with complete structure."
          },
          "response": []
        },
        {
          "name": "3.2.2 - Reward Type Defined in Schema",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Reward type has all fields\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    var fieldNames = jsonData.data.__type.fields.map(f => f.name);",
                  "    pm.expect(fieldNames).to.include.members(['id', 'amount', 'status', 'category']);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "{\n  __type(name: \"Reward\") {\n    name\n    fields {\n      name\n      type {\n        name\n      }\n    }\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**Schema Definition**\n\nReward type defined in schema with complete structure."
          },
          "response": []
        },
        {
          "name": "3.2.3 - Queries Defined in Schema",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Query type has basic operations\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    var fieldNames = jsonData.data.__type.fields.map(f => f.name);",
                  "    pm.expect(fieldNames).to.include.members(['user', 'usersByTier', 'reward', 'rewards']);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "{\n  __type(name: \"Query\") {\n    fields {\n      name\n    }\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**Queries in Schema**\n\nBasic query operations defined in schema."
          },
          "response": []
        },
        {
          "name": "3.2.4 - Mutations Defined in Schema",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Mutation type has basic operations\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    var fieldNames = jsonData.data.__type.fields.map(f => f.name);",
                  "    pm.expect(fieldNames).to.include.members(['createReward', 'redeemCashback']);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "{\n  __type(name: \"Mutation\") {\n    fields {\n      name\n    }\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**Mutations in Schema**\n\nMutation operations defined in schema."
          },
          "response": []
        },
        {
          "name": "3.2.5 - Custom Scalars in Schema",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"DateTime scalar is registered\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.__type.name).to.eql('DateTime');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "{\n  __type(name: \"DateTime\") {\n    name\n    kind\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**Custom Scalar DateTime**\n\nMaps to LocalDateTime in Java via ScalarConfiguration."
          },
          "response": []
        },
        {
          "name": "3.2.6 - Input Types Generated (Codegen)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"CreateRewardInput works correctly\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.createReward.id).to.exist;",
                  "    pm.expect(jsonData.data.createReward.amount).to.be.above(0);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation {\n  createReward(input: {\n    userId: \"user-001\"\n    transactionId: \"txn-test-001\"\n    transactionAmount: 500.0\n    category: TRAVEL\n    description: \"Test codegen\"\n  }) {\n    id\n    amount\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**DGS Codegen**\n\nInput types are generated automatically when `mvn compile` is executed.\n\nClasses appear in `target/generated-sources/dgs-codegen/`"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Section 3.3 - Resolvers with @DgsData",
      "item": [
        {
          "name": "3.3.1 - @DgsQuery Simple",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"User query works\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.user.fullName).to.exist;",
                  "    pm.expect(jsonData.data.user.tier).to.be.oneOf(['BRONZE', 'SILVER', 'GOLD', 'PLATINUM']);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "{\n  user(id: \"user-002\") {\n    fullName\n    tier\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**@DgsQuery Resolver**\n\nSimple query resolver using @DgsQuery annotation."
          },
          "response": []
        },
        {
          "name": "3.3.2 - @DgsQuery with Arguments",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"All users have GOLD tier\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    jsonData.data.usersByTier.forEach(user => {",
                  "        pm.expect(user.tier).to.eql('GOLD');",
                  "    });",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "{\n  usersByTier(tier: GOLD) {\n    fullName\n    tier\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**@DgsQuery with @InputArgument**\n\nQuery resolver with filter arguments."
          },
          "response": []
        },
        {
          "name": "3.3.3 - @DgsQuery with Complex Input",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"All rewards match filter\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    jsonData.data.rewards.forEach(reward => {",
                  "        pm.expect(reward.status).to.eql('ACTIVE');",
                  "        pm.expect(reward.category).to.eql('TRAVEL');",
                  "    });",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "{\n  rewards(filter: {\n    status: ACTIVE\n    category: TRAVEL\n  }) {\n    amount\n    category\n    status\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**Complex Input Filter**\n\nRewardsFilterInput with multiple fields."
          },
          "response": []
        },
        {
          "name": "3.3.4 - @DgsData Nested (Reward -> User)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Reward has nested user\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.reward.user).to.exist;",
                  "    pm.expect(jsonData.data.reward.user.fullName).to.exist;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "{\n  reward(id: \"reward-100\") {\n    amount\n    user {\n      fullName\n      tier\n    }\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**@DgsData for Nested Fields**\n\nResolves Reward.user field using @DgsData."
          },
          "response": []
        },
        {
          "name": "3.3.5 - @DgsData Nested (User -> Rewards)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"User has nested rewards\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.user.rewards).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "{\n  user(id: \"user-003\") {\n    fullName\n    rewards {\n      amount\n      category\n    }\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**@DgsData Inverse Navigation**\n\nResolves User.rewards field using @DgsData."
          },
          "response": []
        },
        {
          "name": "3.3.6 - Aggregated Query",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Summary has calculated totals\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.rewardsSummary.totalEarned).to.be.above(0);",
                  "    pm.expect(jsonData.data.rewardsSummary.availableBalance).to.exist;",
                  "    pm.expect(jsonData.data.rewardsSummary.rewardsByCategory).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "{\n  rewardsSummary(userId: \"user-001\") {\n    totalEarned\n    availableBalance\n    rewardsByCategory {\n      category\n      totalAmount\n    }\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**Aggregated Query**\n\nQuery with business logic calculations in resolver."
          },
          "response": []
        }
      ]
    },
    {
      "name": "Section 3.4 - Mutations & Business Logic",
      "item": [
        {
          "name": "3.4.1 - Create Reward Mutation",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Reward created with calculated cashback\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.createReward.id).to.exist;",
                  "    pm.expect(jsonData.data.createReward.amount).to.be.above(0);",
                  "    pm.expect(jsonData.data.createReward.category).to.eql('TRAVEL');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation {\n  createReward(input: {\n    userId: \"user-001\"\n    transactionId: \"txn-test-001\"\n    transactionAmount: 1000.0\n    category: TRAVEL\n    description: \"Vuelo a Miami\"\n  }) {\n    id\n    amount\n    category\n    multiplier\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**@DgsMutation with Business Logic**\n\nCreates reward with automatic cashback calculation based on category and tier."
          },
          "response": []
        },
        {
          "name": "3.4.2 - Redeem Cashback Mutation",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Cashback redeemed successfully\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.redeemCashback.success).to.be.true;",
                  "    pm.expect(jsonData.data.redeemCashback.message).to.exist;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation {\n  redeemCashback(input: {\n    userId: \"user-002\"\n    amount: 50.0\n    destinationAccount: \"ACC-123456\"\n  }) {\n    success\n    message\n    redeemedAmount\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**Mutation with Validations**\n\nRedeems cashback with balance validation."
          },
          "response": []
        },
        {
          "name": "3.4.3 - Validation: Insufficient Balance",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Redemption rejected\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.redeemCashback.success).to.be.false;",
                  "    pm.expect(jsonData.data.redeemCashback.message).to.include('Insufficient');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation {\n  redeemCashback(input: {\n    userId: \"user-005\"\n    amount: 99999.0\n    destinationAccount: \"ACC-999\"\n  }) {\n    success\n    message\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**Business Rule Validation**\n\nValidates insufficient balance scenario."
          },
          "response": []
        },
        {
          "name": "3.4.4 - Update Reward Status",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Reward status updated\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.updateRewardStatus.status).to.eql('CANCELLED');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation {\n  updateRewardStatus(input: {\n    rewardId: \"reward-101\"\n    newStatus: CANCELLED\n    reason: \"Test de cancelaci\u00f3n\"\n  }) {\n    id\n    status\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**Admin Mutation**\n\nUpdates reward status (admin operation)."
          },
          "response": []
        },
        {
          "name": "3.4.5 - Upgrade User Tier",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"User tier upgraded\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.upgradeUserTier.tier).to.eql('SILVER');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation {\n  upgradeUserTier(userId: \"user-005\", newTier: SILVER) {\n    fullName\n    tier\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**User Tier Mutation**\n\nUpgrades user's cashback tier."
          },
          "response": []
        },
        {
          "name": "3.4.6 - Batch Operation (Expire Rewards)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Batch operation executed\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.expireOldRewards).to.be.a('number');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "mutation {\n  expireOldRewards\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**Batch Mutation**\n\nExpires all old rewards in a single operation."
          },
          "response": []
        }
      ]
    },
    {
      "name": "Section 3.5 - DataLoader & N+1 Problem",
      "item": [
        {
          "name": "3.5.1 - Batch Load (Users -> Rewards)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Multiple users with rewards loaded\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.usersByTier).to.be.an('array');",
                  "    jsonData.data.usersByTier.forEach(user => {",
                  "        pm.expect(user.rewards).to.be.an('array');",
                  "    });",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "{\n  usersByTier(tier: BRONZE) {\n    fullName\n    rewards {\n      amount\n      category\n    }\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**DataLoader Batch Loading**\n\nLoads rewards for multiple users in a single batch.\n\nWithout DataLoader: N+1 queries\nWith DataLoader: 2 queries (1 for users, 1 batch for all rewards)"
          },
          "response": []
        },
        {
          "name": "3.5.2 - Batch Load (Rewards -> Users)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Multiple rewards with users loaded\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.rewards).to.be.an('array');",
                  "    jsonData.data.rewards.forEach(reward => {",
                  "        pm.expect(reward.user).to.exist;",
                  "        pm.expect(reward.user.fullName).to.exist;",
                  "    });",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "{\n  rewards(filter: { status: ACTIVE }) {\n    amount\n    user {\n      fullName\n      tier\n    }\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**Inverse DataLoader**\n\nLoads users for multiple rewards efficiently."
          },
          "response": []
        },
        {
          "name": "3.5.3 - Deep Nested Query",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"3-level navigation works\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.user.rewards).to.be.an('array');",
                  "    jsonData.data.user.rewards.forEach(reward => {",
                  "        pm.expect(reward.user.tier).to.exist;",
                  "    });",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "{\n  user(id: \"user-001\") {\n    fullName\n    rewards {\n      amount\n      user {\n        tier\n      }\n    }\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**Deep Nested Navigation**\n\nUser -> Rewards -> User (3 levels).\n\nDataLoader prevents N+1 even in deep queries."
          },
          "response": []
        },
        {
          "name": "3.5.4 - Filtered Query with DataLoader",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Filtered rewards with users\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.userRewards).to.be.an('array');",
                  "    jsonData.data.userRewards.forEach(reward => {",
                  "        pm.expect(reward.user).to.exist;",
                  "    });",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "{\n  userRewards(userId: \"user-003\", status: ACTIVE) {\n    amount\n    user {\n      fullName\n    }\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**Filtered Query with DataLoader**\n\nCombines filtering with efficient batch loading."
          },
          "response": []
        },
        {
          "name": "3.5.5 - PLATINUM Users with Rewards",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Query returns user data\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.exist;",
                  "    pm.expect(jsonData.data.usersByTier).to.be.an('array');",
                  "});",
                  "",
                  "pm.test(\"Users have rewards array\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.data.usersByTier.length > 0) {",
                  "        jsonData.data.usersByTier.forEach(user => {",
                  "            pm.expect(user.rewards).to.be.an('array');",
                  "        });",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "{\n  usersByTier(tier: PLATINUM) {\n    fullName\n    availableCashback\n    rewards {\n      amount\n      category\n      status\n    }\n  }\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**Complex Batch Query**\n\nMultiple PLATINUM users with all their rewards.\n\nDataLoader ensures optimal performance."
          },
          "response": []
        },
        {
          "name": "3.5.6 - Cashback Rules + Calculation",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Cashback rule and calculation work\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.cashbackRule.basePercentage).to.exist;",
                  "    pm.expect(jsonData.data.calculateCashback).to.be.above(0);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "graphql",
              "graphql": {
                "query": "{\n  cashbackRule(category: TRAVEL) {\n    basePercentage\n    tierMultipliers {\n      platinum\n    }\n  }\n  calculateCashback(\n    userId: \"user-004\"\n    transactionAmount: 5000.0\n    category: TRAVEL\n  )\n}",
                "variables": ""
              }
            },
            "url": {
              "raw": "{{GRAPHQL_ENDPOINT}}",
              "host": [
                "{{GRAPHQL_ENDPOINT}}"
              ]
            },
            "description": "**Business Logic Query**\n\nRetrieves cashback rules and calculates estimated cashback."
          },
          "response": []
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "GRAPHQL_ENDPOINT",
      "value": "http://localhost:8080/graphql",
      "type": "string"
    },
    {
      "key": "BASE_URL",
      "value": "http://localhost:8080",
      "type": "string"
    }
  ]
}