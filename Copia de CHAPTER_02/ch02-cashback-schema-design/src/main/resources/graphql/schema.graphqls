# ==============================================================================
# CAPÃTULO 2: CASHBACK REWARDS - SCHEMA GRAPHQL
# ==============================================================================
#
# ğŸ¯ TEMA: DiseÃ±o profesional de Schemas GraphQL
#
# Este capÃ­tulo enseÃ±a las 8 buenas prÃ¡cticas de diseÃ±o:
# 1. Domain-Driven Design
# 2. SeparaciÃ³n Input/Output
# 3. Custom Scalars
# 4. Nullabilidad correcta
# 5. Relaciones bidireccionales
# 6. Campos calculados
# 7. Enums descriptivos
# 8. Responses estructuradas
#
# ==============================================================================
# MAPEO COMPLETO: SCHEMA GRAPHQL â†” CLASES JAVA
# ==============================================================================
#
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚  SCHEMA GRAPHQL              â”‚  IMPLEMENTACIÃ“N JAVA                       â”‚
# â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚  enum CashbackTier           â”‚  CashbackTier.java (con getBasePercentage) â”‚
# â”‚  enum TransactionCategory    â”‚  TransactionCategory.java (con multiplier) â”‚
# â”‚  enum TransactionStatus      â”‚  TransactionStatus.java                    â”‚
# â”‚  enum RewardStatus           â”‚  RewardStatus.java                         â”‚
# â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚  type User                   â”‚  User.java + UserQueryResolver             â”‚
# â”‚  type Transaction            â”‚  Transaction.java + TransactionQueryResolverâ”‚
# â”‚  type Reward                 â”‚  Reward.java                               â”‚
# â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚  input CreateTransactionInputâ”‚  CreateTransactionInput.java               â”‚
# â”‚  input UpdateUserTierInput   â”‚  UpdateUserTierInput.java                  â”‚
# â”‚  input RedeemCashbackInput   â”‚  RedeemCashbackInput.java                  â”‚
# â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚  type TransactionResponse    â”‚  TransactionResponse.java                  â”‚
# â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚  Query.user                  â”‚  UserQueryResolver.user()                  â”‚
# â”‚  Query.users                 â”‚  UserQueryResolver.users()                 â”‚
# â”‚  Query.transaction           â”‚  TransactionQueryResolver.transaction()    â”‚
# â”‚  Query.transactions          â”‚  TransactionQueryResolver.transactions()   â”‚
# â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚  Mutation.createTransaction  â”‚  TransactionMutationResolver.createTrans() â”‚
# â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚  User.transactions           â”‚  UserQueryResolver.transactions() @Schema  â”‚
# â”‚  User.rewards                â”‚  UserQueryResolver.rewards() @SchemaMappingâ”‚
# â”‚  User.availableCashback      â”‚  UserQueryResolver.availableCashback()     â”‚
# â”‚  User.totalCashbackEarned    â”‚  UserQueryResolver.totalCashbackEarned()   â”‚
# â”‚  User.totalSpent             â”‚  UserQueryResolver.totalSpent()            â”‚
# â”‚  Transaction.user            â”‚  TransactionQueryResolver.user() @Schema   â”‚
# â”‚  Transaction.cashbackAmount  â”‚  TransactionQueryResolver.cashbackAmount() â”‚
# â”‚  Transaction.cashbackPercent â”‚  TransactionQueryResolver.cashbackPercent()â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
# ==============================================================================


# ==============================================================================
# CUSTOM SCALARS
# ==============================================================================
#
# ğŸ“ SECCIÃ“N 2.2: Tipos semÃ¡nticos con validaciÃ³n automÃ¡tica
#
# IMPLEMENTACIÃ“N: GraphQLConfig.java registra estos scalars
# ```java
# @Bean
# public RuntimeWiringConfigurer runtimeWiringConfigurer() {
#     return wiringBuilder -> wiringBuilder
#         .scalar(ExtendedScalars.DateTime)
#         .scalar(moneyScalar())
#         .scalar(percentageScalar())
#         .scalar(emailScalar());
# }
# ```
# ==============================================================================

"ISO-8601 timestamp: 2025-11-15T10:30:00Z"
scalar DateTime

"Decimal preciso para dinero: 125.50 (evita errores de Float)"
scalar Money

"Porcentaje 0-100: 15.5 significa 15.5%"
scalar Percentage

"Email con validaciÃ³n: user@example.com"
scalar Email


# ==============================================================================
# ENUMS
# ==============================================================================

"""
Niveles del programa de cashback.

IMPLEMENTACIÃ“N JAVA: CashbackTier.java
```java
public enum CashbackTier {
    BRONZE(1.0),   // 1% base
    SILVER(2.0),   // 2% base
    GOLD(3.0),     // 3% base
    PLATINUM(5.0); // 5% base
    
    private final double basePercentage;
    
    public double getBasePercentage() {
        return basePercentage;
    }
    
    public double getCashbackPercentage(TransactionCategory category) {
        return basePercentage * category.getCashbackMultiplier();
    }
}
```
"""
enum CashbackTier {
    BRONZE      # 1% cashback base
    SILVER      # 2% cashback base
    GOLD        # 3% cashback base
    PLATINUM    # 5% cashback base
}

"""
CategorÃ­as de transacciones con multiplicadores de cashback.

IMPLEMENTACIÃ“N JAVA: TransactionCategory.java
```java
public enum TransactionCategory {
    GROCERIES(1.5),      // 1.5x multiplier
    RESTAURANTS(2.0),    // 2x multiplier
    GAS_STATIONS(1.5),   // 1.5x multiplier
    TRAVEL(3.0),         // 3x multiplier (mÃ¡ximo)
    ENTERTAINMENT(1.0),  // 1x (sin bonus)
    // ...
    
    public double getCashbackMultiplier() {
        return cashbackMultiplier;
    }
}
```

EJEMPLO DE CÃLCULO:
Usuario GOLD (3%) + CategorÃ­a RESTAURANTS (2x) = 6% cashback
"""
enum TransactionCategory {
    GROCERIES           # 1.5x multiplier
    RESTAURANTS         # 2x multiplier
    GAS_STATIONS        # 1.5x multiplier
    TRAVEL              # 3x multiplier (mÃ¡ximo)
    ENTERTAINMENT       # 1x (sin bonus)
    HEALTH_FITNESS      # 1x
    SHOPPING            # 1x
    UTILITIES           # 1x
    OTHER               # 1x
}

"""
Estado de una transacciÃ³n.

IMPLEMENTACIÃ“N JAVA: TransactionStatus.java
```java
public enum TransactionStatus {
    PENDING,    // Esperando confirmaciÃ³n
    CONFIRMED,  // Cashback calculado
    CANCELLED,  // Sin cashback
    REFUNDED    // Cashback revertido
}
```
"""
enum TransactionStatus {
    PENDING             # Pendiente de confirmaciÃ³n
    CONFIRMED           # Confirmada, cashback calculado
    CANCELLED           # Cancelada, sin cashback
    REFUNDED            # Reembolsada, cashback revertido
}

"""
Estado de una recompensa de cashback.

IMPLEMENTACIÃ“N JAVA: RewardStatus.java
"""
enum RewardStatus {
    PENDING             # 30 dÃ­as de espera
    AVAILABLE           # Listo para canjear
    REDEEMED            # Ya canjeado
    EXPIRED             # 12 meses sin canjear
}


# ==============================================================================
# OUTPUT TYPES (Entidades del dominio)
# ==============================================================================

"""
Usuario del programa de cashback.

IMPLEMENTACIÃ“N JAVA: User.java
```java
public class User {
    private String id;
    private String email;
    private String fullName;
    private CashbackTier tier;
    private LocalDateTime enrolledAt;
    // Getters, setters, builder...
}
```

CAMPOS CALCULADOS: UserQueryResolver.java (@SchemaMapping)
```java
@SchemaMapping(typeName = "User")
public List<Transaction> transactions(User user) {
    return cashbackService.getTransactionsByUserId(user.getId());
}

@SchemaMapping(typeName = "User")
public Double availableCashback(User user) {
    return cashbackService.calculateAvailableCashback(user.getId());
}
```
"""
type User {
    id: ID!
    email: Email!
    fullName: String!
    tier: CashbackTier!
    enrolledAt: DateTime!
    
    """
    RelaciÃ³n 1:N - Resuelto por @SchemaMapping
    JAVA: UserQueryResolver.transactions(User user)
    """
    transactions(
        status: TransactionStatus
        category: TransactionCategory
        limit: Int = 10
        offset: Int = 0
    ): TransactionConnection!
    
    """
    RelaciÃ³n 1:N - Resuelto por @SchemaMapping
    JAVA: UserQueryResolver.rewards(User user)
    """
    rewards(
        status: RewardStatus
        limit: Int = 10
        offset: Int = 0
    ): RewardConnection!
    
    """
    CAMPO CALCULADO - SUM(rewards.amount) WHERE status=AVAILABLE
    JAVA: UserQueryResolver.availableCashback(User user)
    """
    availableCashback: Money!
    
    """
    CAMPO CALCULADO - SUM(rewards.amount) histÃ³rico
    JAVA: UserQueryResolver.totalCashbackEarned(User user)
    """
    totalCashbackEarned: Money!
    
    """
    CAMPO CALCULADO - SUM(transactions.amount) WHERE status=CONFIRMED
    JAVA: UserQueryResolver.totalSpent(User user)
    """
    totalSpent: Money!
}

"""
TransacciÃ³n que genera cashback.

IMPLEMENTACIÃ“N JAVA: Transaction.java
```java
public class Transaction {
    private String id;
    private String userId;           // FK a User
    private Double amount;
    private TransactionCategory category;
    private String merchantName;
    private String description;
    private LocalDateTime transactionDate;
    private TransactionStatus status;
    // Getters, setters, builder...
}
```

CAMPOS CALCULADOS: TransactionQueryResolver.java
```java
@SchemaMapping(typeName = "Transaction")
public User user(Transaction transaction) {
    return cashbackService.getUserById(transaction.getUserId());
}

@SchemaMapping(typeName = "Transaction")
public Double cashbackAmount(Transaction transaction) {
    return cashbackService.calculateCashbackAmount(transaction);
}

@SchemaMapping(typeName = "Transaction")
public Double cashbackPercentage(Transaction transaction) {
    return cashbackService.calculateCashbackPercentage(transaction);
}
```
"""
type Transaction {
    id: ID!
    
    """
    RelaciÃ³n N:1 - Resuelto por @SchemaMapping
    JAVA: TransactionQueryResolver.user(Transaction tx)
    """
    user: User!
    
    amount: Money!
    category: TransactionCategory!
    merchantName: String!
    description: String              # Nullable - puede ser null
    transactionDate: DateTime!
    status: TransactionStatus!
    
    """
    CAMPO CALCULADO: amount Ã— (tierPercentage Ã— categoryMultiplier)
    JAVA: TransactionQueryResolver.cashbackAmount(Transaction tx)
    
    Ejemplo: $100 Ã— (3% GOLD Ã— 2 RESTAURANTS) = $6.00
    """
    cashbackAmount: Money!
    
    """
    CAMPO CALCULADO: tierPercentage Ã— categoryMultiplier
    JAVA: TransactionQueryResolver.cashbackPercentage(Transaction tx)
    
    Ejemplo: 3% GOLD Ã— 2 RESTAURANTS = 6%
    """
    cashbackPercentage: Percentage!
    
    reward: Reward                   # Nullable - solo si ya se creÃ³
}

"""
Recompensa de cashback ganada.

IMPLEMENTACIÃ“N JAVA: Reward.java
```java
public class Reward {
    private String id;
    private String userId;
    private String transactionId;
    private Double amount;
    private LocalDateTime earnedAt;
    private LocalDateTime expiresAt;
    private RewardStatus status;
    private LocalDateTime redeemedAt;     // Nullable
    private String redemptionMethod;      // Nullable
}
```
"""
type Reward {
    id: ID!
    user: User!
    transaction: Transaction!
    amount: Money!
    earnedAt: DateTime!
    expiresAt: DateTime!
    status: RewardStatus!
    redeemedAt: DateTime             # Nullable - solo si fue canjeada
    redemptionMethod: String         # Nullable - solo si fue canjeada
}


# ==============================================================================
# CONNECTION TYPES (PaginaciÃ³n Relay)
# ==============================================================================

type TransactionConnection {
    edges: [TransactionEdge!]!
    pageInfo: PageInfo!
    totalCount: Int!
}

type TransactionEdge {
    cursor: String!
    node: Transaction!
}

type RewardConnection {
    edges: [RewardEdge!]!
    pageInfo: PageInfo!
    totalCount: Int!
}

type RewardEdge {
    cursor: String!
    node: Reward!
}

type PageInfo {
    hasNextPage: Boolean!
    hasPreviousPage: Boolean!
    startCursor: String
    endCursor: String
}


# ==============================================================================
# INPUT TYPES
# ==============================================================================
#
# ğŸ“ SECCIÃ“N 2.2: SeparaciÃ³n Input/Output
#
# Â¿Por quÃ© inputs separados?
# - Input NO tiene id (se genera en servidor)
# - Input NO tiene status (siempre empieza PENDING)
# - Input NO tiene campos calculados
# - Pueden evolucionar independientemente
# ==============================================================================

"""
Input para crear transacciÃ³n.

IMPLEMENTACIÃ“N JAVA: CreateTransactionInput.java
```java
public class CreateTransactionInput {
    private String userId;
    private Double amount;
    private TransactionCategory category;
    private String merchantName;
    private String description;           // Opcional
    private LocalDateTime transactionDate; // Opcional
}
```

COMPARACIÃ“N INPUT vs OUTPUT:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Campo               â”‚ Input (cliente)  â”‚ Output (servidor)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id                  â”‚ âŒ No existe     â”‚ âœ… Generado         â”‚
â”‚ userId              â”‚ âœ… Requerido     â”‚ âŒ (tiene user obj) â”‚
â”‚ amount              â”‚ âœ… Requerido     â”‚ âœ…                  â”‚
â”‚ category            â”‚ âœ… Requerido     â”‚ âœ…                  â”‚
â”‚ merchantName        â”‚ âœ… Requerido     â”‚ âœ…                  â”‚
â”‚ description         â”‚ â­• Opcional      â”‚ â­• Nullable         â”‚
â”‚ status              â”‚ âŒ No existe     â”‚ âœ… PENDINGâ†’CONFIRMEDâ”‚
â”‚ cashbackAmount      â”‚ âŒ No existe     â”‚ âœ… Calculado        â”‚
â”‚ cashbackPercentage  â”‚ âŒ No existe     â”‚ âœ… Calculado        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
"""
input CreateTransactionInput {
    userId: ID!
    amount: Money!
    category: TransactionCategory!
    merchantName: String!
    description: String              # Opcional
    transactionDate: DateTime        # Opcional (default: now)
}

"""
Input para actualizar tier de usuario.

IMPLEMENTACIÃ“N JAVA: UpdateUserTierInput.java
```java
public class UpdateUserTierInput {
    private String userId;
    private CashbackTier newTier;
    private String reason;           // Para auditorÃ­a
}
```
"""
input UpdateUserTierInput {
    userId: ID!
    newTier: CashbackTier!
    reason: String                   # Para auditorÃ­a
}

"""
Input para canjear cashback.

IMPLEMENTACIÃ“N JAVA: RedeemCashbackInput.java
```java
public class RedeemCashbackInput {
    private String userId;
    private Double amount;
    private String redemptionMethod; // BANK_TRANSFER, GIFT_CARD, etc.
}
```
"""
input RedeemCashbackInput {
    userId: ID!
    amount: Money!
    redemptionMethod: String!        # BANK_TRANSFER, GIFT_CARD, etc.
}

input CancelTransactionInput {
    transactionId: ID!
    reason: String!
}


# ==============================================================================
# RESPONSE TYPES
# ==============================================================================
#
# ğŸ“ SECCIÃ“N 2.2: Respuestas estructuradas
#
# PatrÃ³n consistente: { success, message, data }
# ==============================================================================

"""
Respuesta para mutations de transacciÃ³n.

IMPLEMENTACIÃ“N JAVA: TransactionResponse.java
```java
public class TransactionResponse {
    private Boolean success;
    private String message;
    private Transaction transaction;  // null si error
    
    public static Builder builder() { ... }
}
```

USO EN RESOLVER:
```java
@MutationMapping
public TransactionResponse createTransaction(@Argument CreateTransactionInput input) {
    try {
        Transaction tx = cashbackService.createTransaction(...);
        return TransactionResponse.builder()
            .success(true)
            .message("Transaction created successfully")
            .transaction(tx)
            .build();
    } catch (Exception e) {
        return TransactionResponse.builder()
            .success(false)
            .message("Error: " + e.getMessage())
            .build();
    }
}
```
"""
type TransactionResponse {
    success: Boolean!
    message: String!
    transaction: Transaction         # null si error
}

type RedemptionResponse {
    success: Boolean!
    message: String!
    redeemedAmount: Money
    remainingCashback: Money
    rewards: [Reward!]
}

type TierUpdateResponse {
    success: Boolean!
    message: String!
    user: User
    previousTier: CashbackTier
    newTier: CashbackTier
}


# ==============================================================================
# QUERIES
# ==============================================================================

type Query {
    
    """
    Obtener usuario por ID.
    
    JAVA: UserQueryResolver.user()
```java
    @QueryMapping
    public User user(@Argument String id) {
        return cashbackService.getUserById(id);
    }
```
    """
    user(id: ID!): User
    
    """
    Buscar usuario por email.
    
    JAVA: UserQueryResolver.userByEmail()
    """
    userByEmail(email: Email!): User
    
    """
    Listar usuarios con filtro opcional por tier.
    
    JAVA: UserQueryResolver.users()
```java
    @QueryMapping
    public List<User> users(@Argument CashbackTier tier) {
        List<User> allUsers = cashbackService.getAllUsers();
        if (tier == null) return allUsers;
        return allUsers.stream()
            .filter(u -> u.getTier() == tier)
            .toList();
    }
```
    """
    users(
        tier: CashbackTier
        limit: Int = 20
        offset: Int = 0
    ): [User!]!
    
    """
    Obtener transacciÃ³n por ID.
    
    JAVA: TransactionQueryResolver.transaction()
    """
    transaction(id: ID!): Transaction
    
    """
    Listar transacciones con mÃºltiples filtros opcionales.
    
    JAVA: TransactionQueryResolver.transactions()
```java
    @QueryMapping
    public List<Transaction> transactions(
            @Argument String userId,
            @Argument TransactionStatus status,
            @Argument TransactionCategory category) {
        
        List<Transaction> txs = (userId != null) 
            ? cashbackService.getTransactionsByUserId(userId)
            : cashbackService.getAllTransactions();
        
        if (status != null) {
            txs = txs.stream().filter(t -> t.getStatus() == status).toList();
        }
        if (category != null) {
            txs = txs.stream().filter(t -> t.getCategory() == category).toList();
        }
        return txs;
    }
```
    """
    transactions(
        userId: ID
        status: TransactionStatus
        category: TransactionCategory
        minAmount: Money
        maxAmount: Money
        startDate: DateTime
        endDate: DateTime
        limit: Int = 20
        offset: Int = 0
    ): [Transaction!]!
    
    reward(id: ID!): Reward
    
    rewards(
        userId: ID
        status: RewardStatus
        limit: Int = 20
        offset: Int = 0
    ): RewardConnection!
    
    cashbackSummary(userId: ID!): CashbackSummary!
}

type CashbackSummary {
    userId: ID!
    totalEarned: Money!
    totalAvailable: Money!
    totalRedeemed: Money!
    totalExpired: Money!
    byCategory: [CategoryCashback!]!
    byMonth: [MonthlyCashback!]!
    currentTier: CashbackTier!
    nextTier: CashbackTier
    amountToNextTier: Money
}

type CategoryCashback {
    category: TransactionCategory!
    totalEarned: Money!
    transactionCount: Int!
    averagePercentage: Percentage!
}

type MonthlyCashback {
    month: String!
    earned: Money!
    redeemed: Money!
    transactionCount: Int!
}


# ==============================================================================
# MUTATIONS
# ==============================================================================

type Mutation {
    
    """
    Crear nueva transacciÃ³n y calcular cashback.
    
    JAVA: TransactionMutationResolver.createTransaction()
```java
    @MutationMapping
    public TransactionResponse createTransaction(
            @Argument CreateTransactionInput input) {
        try {
            Transaction tx = cashbackService.createTransaction(
                input.getUserId(),
                input.getAmount(),
                input.getCategory(),
                input.getMerchantName(),
                input.getDescription(),
                input.getTransactionDate()
            );
            tx = cashbackService.confirmTransaction(tx.getId());
            
            return TransactionResponse.builder()
                .success(true)
                .message("Transaction created successfully")
                .transaction(tx)
                .build();
        } catch (Exception e) {
            return TransactionResponse.builder()
                .success(false)
                .message("Error: " + e.getMessage())
                .build();
        }
    }
```
    
    EJEMPLO:
```graphql
    mutation {
      createTransaction(input: {
        userId: "user-001"
        amount: 150.00
        category: RESTAURANTS
        merchantName: "Pizza Palace"
      }) {
        success
        message
        transaction {
          id
          cashbackAmount      # Calculado automÃ¡ticamente
          cashbackPercentage  # Calculado automÃ¡ticamente
        }
      }
    }
```
    """
    createTransaction(input: CreateTransactionInput!): TransactionResponse!
    
    cancelTransaction(input: CancelTransactionInput!): TransactionResponse!
    
    redeemCashback(input: RedeemCashbackInput!): RedemptionResponse!
    
    updateUserTier(input: UpdateUserTierInput!): TierUpdateResponse!
}


# ==============================================================================
# RESUMEN: ARCHIVOS JAVA DEL CAPÃTULO 2
# ==============================================================================
#
# ğŸ“¦ MODELOS (model/):
# â”œâ”€â”€ User.java                    â†’ type User
# â”œâ”€â”€ Transaction.java             â†’ type Transaction  
# â”œâ”€â”€ Reward.java                  â†’ type Reward
# â”œâ”€â”€ CashbackTier.java            â†’ enum CashbackTier (con porcentajes)
# â”œâ”€â”€ TransactionCategory.java     â†’ enum TransactionCategory (con multipliers)
# â”œâ”€â”€ TransactionStatus.java       â†’ enum TransactionStatus
# â””â”€â”€ RewardStatus.java            â†’ enum RewardStatus
#
# ğŸ“¦ INPUTS (model/input/):
# â”œâ”€â”€ CreateTransactionInput.java  â†’ input CreateTransactionInput
# â”œâ”€â”€ UpdateUserTierInput.java     â†’ input UpdateUserTierInput
# â””â”€â”€ RedeemCashbackInput.java     â†’ input RedeemCashbackInput
#
# ğŸ“¦ RESPONSES (model/response/):
# â””â”€â”€ TransactionResponse.java     â†’ type TransactionResponse
#
# ğŸ“¦ RESOLVERS (graphql/):
# â”œâ”€â”€ UserQueryResolver.java       â†’ Query.user, users + @SchemaMapping campos
# â”œâ”€â”€ TransactionQueryResolver.javaâ†’ Query.transaction + @SchemaMapping campos
# â””â”€â”€ TransactionMutationResolver.java â†’ Mutation.createTransaction
#
# ğŸ“¦ CONFIG:
# â””â”€â”€ GraphQLConfig.java           â†’ Registro de custom scalars
#
# ==============================================================================